#!/bin/bash
# Pre-push hook: reminds about version bumps when pushing Go changes to main
# Install: make hooks

while read local_ref local_sha remote_ref remote_sha; do
    if [[ "$remote_ref" == "refs/heads/main" ]]; then
        LATEST_TAG=$(git tag -l 'v*' --sort=-v:refname | head -n1)
        [ -z "$LATEST_TAG" ] && continue

        GO_CHANGES=$(git diff --name-only "$LATEST_TAG"..HEAD -- '*.go' ':!vendor/' 2>/dev/null | wc -l | tr -d ' ')

        if [ "$GO_CHANGES" -gt 0 ]; then
            echo ""
            echo "=== GCI Release Reminder ==="
            echo "$GO_CHANGES Go file(s) changed since $LATEST_TAG."
            echo "A patch release will be created automatically."
            echo "For minor/major: git tag -a v1.1.0 -m 'Release v1.1.0' && git push origin v1.1.0"
            echo "============================="
            echo ""
        fi
    fi
done
